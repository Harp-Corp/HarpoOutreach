version: "3.9"

services:
  harpo-web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: harpo-outreach-web
    ports:
      - "8080:8080"
    environment:
      # Google OAuth
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - GOOGLE_REDIRECT_URI=${GOOGLE_REDIRECT_URI:-http://localhost:8080/api/v1/auth/callback}
      # Perplexity
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY}
      # Vapor
      - VAPOR_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-notice}
    volumes:
      # Mount Public folder for live frontend updates
      - ./Public:/app/Public:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

# Usage:
# 1. Copy .env.example to .env and fill in your credentials
# 2. docker-compose up --build
# 3. Open http://localhost:8080
#
# Required environment variables (set in .env):
#   GOOGLE_CLIENT_ID        - Google OAuth Client ID
#   GOOGLE_CLIENT_SECRET    - Google OAuth Client Secret
#   PERPLEXITY_API_KEY      - Perplexity AI API Key
#
# Optional:
#   GOOGLE_REDIRECT_URI     - OAuth callback URL (default: http://localhost:8080/api/v1/auth/callback)
#   LOG_LEVEL               - Vapor log level (debug, info, notice, warning, error)
